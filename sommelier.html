<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digitaler Sommelier</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #8B0000; }
        form { margin-bottom: 20px; }
        label { display: block; margin: 10px 0 5px; }
        input { width: 100%; padding: 8px; }
        button { background-color: #8B0000; color: white; padding: 10px; border: none; cursor: pointer; }
        #results { margin-top: 20px; }
        .wein { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .wein h2 { margin-top: 0; }
    </style>
</head>
<body>
    <h1>Digitaler Sommelier</h1>
    <p>Willkommen! Geben Sie Ihre Vorlieben ein, um Weinempfehlungen zu erhalten.</p>
    
    <form id="sommelierForm">
        <label for="typ">Welchen Typ Wein bevorzugen Sie (rot/wei√ü oder leer f√ºr alle)?</label>
        <input type="text" id="typ" name="typ">
        
        <label for="suessgrad">S√º√ügrad (trocken/halbtrocken/s√º√ü oder leer f√ºr alle)?</label>
        <input type="text" id="suessgrad" name="suessgrad">
        
        <label for="geschmacksvorliebe">Geschmacksvorliebe (z.B. fruchtig, tanninreich oder leer)?</label>
        <input type="text" id="geschmacksvorliebe" name="geschmacksvorliebe">
        
        <button type="submit">Empfehlungen anzeigen</button>
    </form>
    
    <div id="results"></div>
    
    <script>
        const weine = {
            "Cabernet Sauvignon": {
                "typ": "rot",
                "suessgrad": "trocken",
                "geschmack": "Beerenaromen wie schwarze Johannisbeere, Brombeere, mit Noten von Vanille und Eiche.",
                "geruch": "Intensiv nach dunklen Fr√ºchten, Tabak und Leder.",
                "mundgefuehl": "Vollmundig, tanninreich, mit fester Struktur und langem Abgang.",
                "preis": "Mittel bis hoch",
                "essen": "Zu gegrilltem Fleisch, Wild oder reifem K√§se."
            },
            "Chardonnay": {
                "typ": "wei√ü",
                "suessgrad": "trocken",
                "geschmack": "Tropische Fr√ºchte wie Ananas und Mango, mit Butter- und Nussnoten.",
                "geruch": "Fruchtig nach Apfel, Zitrus und Eiche.",
                "mundgefuehl": "Cremig, mittelkr√§ftig, mit ausgewogener S√§ure.",
                "preis": "Mittel",
                "essen": "Zu Fisch, Gefl√ºgel oder cremigen Pastagerichten."
            },
            "Riesling": {
                "typ": "wei√ü",
                "suessgrad": "halbtrocken",
                "geschmack": "Frische Zitrusfr√ºchte, Apfel und Pfirsich, mit mineralischer Note.",
                "geruch": "Blumig und fruchtig nach Limette, Honig und Petrol.",
                "mundgefuehl": "Leicht, erfrischend, mit lebendiger S√§ure.",
                "preis": "Niedrig bis mittel",
                "essen": "Zu asiatischer K√ºche, scharfen Gerichten oder als Aperitif."
            },
            "Pinot Noir": {
                "typ": "rot",
                "suessgrad": "trocken",
                "geschmack": "Rote Beeren wie Kirsche und Erdbeere, mit erdigen Untert√∂nen.",
                "geruch": "Fein nach Himbeere, Pilzen und Gew√ºrzen.",
                "mundgefuehl": "Elegant, seidig, mit milden Tanninen.",
                "preis": "Mittel bis hoch",
                "essen": "Zu Lachs, Ente oder Pilzgerichten."
            },
            "Merlot": {
                "typ": "rot",
                "suessgrad": "trocken",
                "geschmack": "Pflaumen, Schokolade und weiche Fr√ºchte.",
                "geruch": "Nach reifen Beeren, Kr√§utern und Vanille.",
                "mundgefuehl": "Weich, rund, mit moderaten Tanninen.",
                "preis": "Niedrig bis mittel",
                "essen": "Zu Pasta, Burgern oder mildem K√§se."
            }
        };

        function empfehleWein(typ, suessgrad, geschmacksvorliebe) {
            let empfehlungen = [];
            for (let name in weine) {
                let info = weine[name];
                if ((typ.toLowerCase() === info.typ || typ === "") &&
                    (suessgrad.toLowerCase() === info.suessgrad || suessgrad === "")) {
                    if (geschmacksvorliebe.toLowerCase() === "" || info.geschmack.toLowerCase().includes(geschmacksvorliebe.toLowerCase())) {
                        empfehlungen.push({ name: name, info: info });
                    }
                }
            }
            return empfehlungen;
        }

        function beschreibeWein(wein) {
            return `
                <div class="wein">
                    <h2>${wein.name}</h2>
                    <p><strong>Geschmacklich:</strong> ${wein.info.geschmack}</p>
                    <p><strong>Olfaktorisch:</strong> ${wein.info.geruch}</p>
                    <p><strong>Taktil:</strong> ${wein.info.mundgefuehl}</p>
                    <p><strong>Preisrahmen:</strong> ${wein.info.preis}</p>
                    <p><strong>Passend zu:</strong> ${wein.info.essen}</p>
                </div>
            `;
        }

        document.getElementById('sommelierForm').addEventListener('submit', function(event) {
            event.preventDefault();
            let typ = document.getElementById('typ').value;
            let suessgrad = document.getElementById('suessgrad').value;
            let geschmacksvorliebe = document.getElementById('geschmacksvorliebe').value;
            
            let empfehlungen = empfehleWein(typ, suessgrad, geschmacksvorliebe);
            let resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            if (empfehlungen.length > 0) {
                resultsDiv.innerHTML = `<p>Ich habe ${empfehlungen.length} Empfehlung(en) f√ºr Sie:</p>`;
                empfehlungen.forEach(wein => {
                    resultsDiv.innerHTML += beschreibeWein(wein);
                });
            } else {
                resultsDiv.innerHTML = '<p>Leider keine passenden Empfehlungen. Versuchen Sie breitere Kriterien!</p>';
            }
        });
    <script>
    // --- 1. Die "Bio-Datenbank" (Das Gehirn aus dem Colab) ---
    const wineDatabase = [
        {
            id: "prime_red",
            type: "rot",
            mood: "kamin",
            name: "Rosary 'Deep Roots' Sp√§tburgunder",
            desc: "Ein tiefgr√ºndiger Roter, gewachsen auf vulkanischem Gestein. Noten von dunkler Kirsche und Erde.",
            // Die Wissenschaft:
            proteinID: "1TQN", // Cholin-Dehydrogenase (Stress-Resilienz)
            scienceTitle: "Enzym: Cholin-Dehydrogenase (Stress-Schild)",
            scienceDesc: "Dieser Wein stammt von Reben, die Hitzestress durch Glycinbetain-Produktion √ºberlebt haben. Das angezeigte Protein ist der Motor dieser Schutzfunktion."
        },
        {
            id: "solaris_white",
            type: "weiss",
            mood: "terrasse",
            name: "Rosary 'Solaris' Bio-Cuv√©e",
            desc: "Spritzig, pilzwiderstandsf√§hig (PIWI) und voller Sonnenenergie.",
            // Die Wissenschaft:
            proteinID: "1CAG", // Kollagenase (Symbolisch f√ºr Strukturabbau/Reife oder Chitinase f√ºr Abwehr)
            // Besser: Chitinase (Abwehr gegen Pilze) -> PDB: 1DXJ
            proteinID: "1DXJ", 
            scienceTitle: "Enzym: Chitinase (Die nat√ºrliche Abwehr)",
            scienceDesc: "Da dies eine PIWI-Sorte ist, zeigt das Protein die nat√ºrliche Abwehrkraft der Pflanze gegen Pilze. Weniger Spritzmittel, mehr Natur."
        },
        {
            id: "harmony_rose",
            type: "rose",
            mood: "dinner",
            name: "Rosary 'Harmony' Ros√©",
            desc: "Die perfekte Balance zwischen Frucht und S√§ure. Ein Begleiter f√ºr leichte K√ºche.",
            // Die Wissenschaft:
            proteinID: "3MJD", // Invertase/Sucrose (Zuckerstoffwechsel)
            scienceTitle: "Enzym: Invertase (S√º√üe-S√§ure-Spiel)",
            scienceDesc: "Dieses Enzym spaltet Zucker in der Traube und sorgt f√ºr den feinen Schmelz dieses Weines auf der Zunge."
        }
        // Hier k√∂nnen wir weitere Weine aus dem NotebookML hinzuf√ºgen
    ];

    // --- 2. Die Sommelier Logik ---
    function empfehleWein() {
        const typ = document.getElementById('typ').value;
        const anlass = document.getElementById('anlass').value;
        
        // Suche passenden Wein (einfacher Filter)
        // Logik: Wir suchen einen Wein, der zum Typ passt. 
        // Falls Anlass nicht passt, nehmen wir trotzdem den ersten Treffer des Typs (Fallback).
        let match = wineDatabase.find(w => w.type === typ && w.mood === anlass);
        
        if (!match) {
            // Fallback: Suche nur nach Typ
            match = wineDatabase.find(w => w.type === typ);
        }

        if (match) {
            // Text Update
            document.getElementById('weinName').innerText = "üçæ Empfehlung: " + match.name;
            document.getElementById('weinDesc').innerText = match.desc;
            document.getElementById('results').style.display = 'block';
            
            // Update Science Badge & Text
            document.querySelector('.viewer-header').innerHTML = `
                üî¨ <b>Molecular Insight:</b> ${match.scienceTitle}
                <br><span style="font-size:0.8em; opacity:0.8;">${match.scienceDesc}</span>
            `;

            // 3D Viewer starten mit der spezifischen Protein-ID
            showProtein(match.proteinID);
        }
    }

    // --- 3. Die AlphaFold/PDB Visualisierung ---
    let viewer = null; // Globaler Viewer, damit wir ihn nicht 100x neu erstellen

    function showProtein(pdbId) {
        const viewerDiv = document.getElementById('protein-viewer-container');
        viewerDiv.style.display = 'block';

        let element = document.getElementById('viewer_3d');
        
        // Viewer nur einmal initialisieren, sonst gibt es Grafik-Fehler
        if (!viewer) {
            let config = { backgroundColor: 'white' };
            viewer = $3Dmol.createViewer(element, config);
        }

        viewer.clear(); // Altes Molek√ºl l√∂schen
        
        // Lade neue Struktur live von der RCSB Datenbank
        $3Dmol.download("pdb:" + pdbId, viewer, {doAssembly:true, noSecondaryStructure:false}, function() {
            // Style: Cartoon (B√§nder) + Stick (Molek√ºle) f√ºr Details
            viewer.setStyle({}, {cartoon: {color: 'spectrum'}});
            viewer.zoomTo();
            viewer.render();
        });
    }
</script>
