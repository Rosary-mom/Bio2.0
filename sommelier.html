<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rosary Bio2.0 | Digital Molecular Sommelier</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #8B0000; /* Weinrot */
            --accent-color: #D4AF37;  /* Gold */
            --bg-color: #f9f9f9;
            --text-color: #333;
            --sold-out-color: #95a5a6; /* Grau f√ºr Ausverkauft */
        }

        body { 
            font-family: 'Lato', sans-serif; 
            background: var(--bg-color); 
            color: var(--text-color); 
            margin: 0; padding: 0; 
        }

        /* Hero Section */
        header {
            background: linear-gradient(135deg, #2c3e50, #000);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        h1 { font-family: 'Playfair Display', serif; margin: 0; font-size: 2.5em; color: var(--accent-color); }
        .subtitle { font-style: italic; opacity: 0.8; margin-top: 10px; }

        /* Container */
        .container { 
            max-width: 900px; 
            margin: -30px auto 40px; 
            background: white; 
            padding: 40px; 
            border-radius: 8px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            position: relative;
        }

        /* --- SOMMELIER BEREICH --- */
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 2px dashed #eee;
            padding-bottom: 30px;
        }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px; }
        select { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; 
            background: #fff; font-size: 16px; transition: border 0.3s;
        }
        select:focus { border-color: var(--primary-color); outline: none; }
        
        button.cta-btn { 
            grid-column: 1 / -1;
            padding: 15px; background-color: var(--primary-color); color: white; 
            border: none; border-radius: 4px; font-size: 18px; cursor: pointer; 
            transition: transform 0.2s, background 0.3s; text-transform: uppercase; font-weight: bold;
        }
        button.cta-btn:hover { background-color: #600000; transform: translateY(-2px); }

        /* --- ERGEBNIS BEREICH --- */
        .result-section { display: none; animation: fadeIn 0.5s ease-in-out; margin-bottom: 50px; }
        
        .recommendation-card {
            border-left: 5px solid var(--primary-color);
            background: #fff5f5;
            padding: 20px;
            margin-bottom: 30px;
        }
        .recommendation-card h2 { margin-top: 0; color: var(--primary-color); font-family: 'Playfair Display', serif; }

        .viz-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .control-panel, .viz-grid { grid-template-columns: 1fr; } }

        .viz-box { border: 1px solid #eee; border-radius: 8px; overflow: hidden; background: white; }
        .viz-header { background: #f4f4f4; padding: 10px; text-align: center; font-weight: bold; border-bottom: 1px solid #eee; font-size: 0.9em; }
        #viewer_3d { width: 100%; height: 300px; position: relative; }
        .chart-wrapper { position: relative; height: 300px; padding: 10px; }

        /* --- NEU: WEINBANK (SHOP REGAL) --- */
        .shelf-title { text-align: center; margin-top: 50px; font-family: 'Playfair Display', serif; color: #2c3e50; }
        .shelf-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .wine-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s;
        }
        .wine-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .wine-img {
            width: 100%; height: 200px; object-fit: cover;
            background-color: #eee; border-radius: 4px; margin-bottom: 10px;
        }
        .wine-name { font-weight: bold; margin-bottom: 5px; color: var(--primary-color); }
        .wine-status {
            display: inline-block; padding: 5px 10px; border-radius: 20px;
            font-size: 0.8em; font-weight: bold; margin-top: 10px;
        }
        .status-soldout { background: #eee; color: #777; border: 1px solid #ccc; }
        .status-available { background: var(--accent-color); color: #000; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1>Digital Molecular Sommelier</h1>
    <p class="subtitle">Rosary Bio2.0 ‚Äì Wo Sensorik auf Wissenschaft trifft</p>
</header>

<div class="container">
    
    <div class="control-panel">
        <div class="form-group">
            <label for="typ">Weinart</label>
            <select id="typ">
                <option value="rot">Rotwein (Tiefgr√ºndig)</option>
                <option value="weiss">Wei√üwein (Frisch)</option>
                <option value="rose">Ros√© (Balance)</option>
            </select>
        </div>
        <div class="form-group">
            <label for="anlass">Atmosph√§re</label>
            <select id="anlass">
                <option value="kamin">Kaminabend / Meditation</option>
                <option value="terrasse">Sommerterrasse / Party</option>
                <option value="dinner">Fine Dining / Eleganz</option>
            </select>
        </div>
        <button class="cta-btn" onclick="starteAnalyse()">Analyse starten</button>
    </div>

    <div id="results" class="result-section">
        <div class="recommendation-card">
            <h2 id="weinName"></h2>
            <p id="weinDesc" style="font-size: 1.1em; line-height: 1.6;"></p>
        </div>
        <div class="viz-grid">
            <div class="viz-box">
                <div class="viz-header">üî¨ Aktives Boden-Enzym (AlphaFold)</div>
                <div id="viewer_3d"></div>
                <div style="padding:10px; font-size:0.85em; color:#666; text-align:center;" id="science-text"></div>
            </div>
            <div class="viz-box">
                <div class="viz-header">üó∫Ô∏è Chemischer Fingerabdruck (PCA)</div>
                <div class="chart-wrapper"><canvas id="terroirChart"></canvas></div>
                <div style="padding:10px; font-size:0.85em; color:#666; text-align:center;">Position im Geschmacks-Universum.</div>
            </div>
        </div>
    </div>

    <h3 class="shelf-title">üç∑ Die Rosary Weinbank</h3>
    <div class="shelf-grid" id="wineShelf">
        </div>

</div>

<script>
    // ================= DATENBANK (Inkl. Bilder & Lagerbestand) =================
    const wineDatabase = [
        {
            id: "prime_red", type: "rot", mood: "kamin",
            name: "Deep Roots Sp√§tburgunder",
            desc: "Vulkanischer Boden, tiefe Wurzeln. Ein Monument.",
            proteinID: "1TQN", science: "Enzym: Cholin-Dehydrogenase (Hitzeschutz).",
            // Placeholder Bildgenerator (Farbe 8B0000 = Dunkelrot)
            image: "https://placehold.co/400x600/8B0000/FFFFFF?text=DEEP+ROOTS\nSp√§tburgunder",
            inStock: false // AUSVERKAUFT
        },
        {
            id: "phoenix_garden", 
            type: "weiss", 
            mood: "terrasse",
            name: "Rosary 'Bio Ph√∂nix' Garden Select",
            desc: "Unser ganzer Stolz aus dem eigenen Garten. PIWI-Sorte mit feinem Muskat-Aroma. 100% Handarbeit, 0% Chemie.",
            proteinID: "1DXJ", // Chitinase passt hier perfekt (nat√ºrliche Resistenz)!
            science: "Enzym: Chitinase. Die nat√ºrliche Abwehrkraft der Ph√∂nix-Rebe macht Spritzmittel √ºberfl√ºssig.",
            // Ihr echtes Bild oder Placeholder in Gr√ºn/Gelb
            image: "https://placehold.co/400x600/6B8E23/FFFFFF?text=BIO+PH√ñNIX\nGarden+Select",
            inStock: false // Bleibt "Ausverkauft" (Eigenverbrauch), aber zeigt, was da ist!
        },
        {
            id: "harmony_rose", type: "rose", mood: "dinner",
            name: "Harmony Ros√©",
            desc: "Die perfekte Balance zwischen Frucht und Mineralik.",
            proteinID: "3MJD", science: "Enzym: Invertase (Zucker-S√§ure-Spiel).",
            // Placeholder Bildgenerator (Farbe E91E63 = Pink)
            image: "https://placehold.co/400x600/E91E63/FFFFFF?text=HARMONY\nRos√©",
            inStock: false // AUSVERKAUFT
        },
        {
            // Der italienische Klassiker (Spezialfall)
            id: "messwein_italy", type: "rot", mood: "kamin",
            name: "Vino Sacro (Italia)",
            desc: "Historischer Messwein. F√ºr besondere liturgische Momente.",
            proteinID: "4EAR", // Dummy ID (Ethanol-Metabolismus Enzym)
            science: "Traditionelle Kelterung nach liturgischen Vorschriften.",
            // Placeholder Bildgenerator (Farbe 555 = Grau/Schwarz)
            image: "https://placehold.co/400x600/333333/FFFFFF?text=VINO+SACRO\nMesswein",
            inStock: false // Auch ausverkauft? Oder true setzen wenn vorhanden!
        }
    ];

    // PCA Daten (Statisch)
    const pcaData = [
        { x: -2.5, y: 0.5, type: "Rot (Komplex)" }, { x: -2.3, y: 0.8, type: "Rot (Komplex)" },
        { x: 2.1, y: -1.2, type: "Wei√ü (Frisch)" }, { x: 1.9, y: -0.9, type: "Wei√ü (Frisch)" },
        { x: 0.1, y: 1.5, type: "Ros√© (Balance)" }, { x: -0.2, y: 1.2, type: "Ros√© (Balance)" }
    ];

    // ================= INITIALISIERUNG =================
    
    // 1. Weinregal aufbauen (Sofort beim Laden)
    window.onload = function() {
        renderShelf();
    };

    function renderShelf() {
        const shelfContainer = document.getElementById('wineShelf');
        shelfContainer.innerHTML = '';

        wineDatabase.forEach(wine => {
            // Status Button Logik
            let statusBadge = wine.inStock 
                ? '<span class="wine-status status-available">üõí Verf√ºgbar</span>' 
                : '<span class="wine-status status-soldout">üö´ Zur Zeit ausverkauft</span>';

            // HTML Karte bauen
            const cardHTML = `
                <div class="wine-card">
                    <img src="${wine.image}" alt="${wine.name}" class="wine-img">
                    <div class="wine-name">${wine.name}</div>
                    <div style="font-size:0.85em; color:#666; margin-bottom:10px;">${wine.desc}</div>
                    ${statusBadge}
                </div>
            `;
            shelfContainer.innerHTML += cardHTML;
        });
    }

    // ================= SOMMELIER LOGIK =================
    let chartInstance = null;
    let viewer = null;

    function starteAnalyse() {
        const typ = document.getElementById('typ').value;
        const anlass = document.getElementById('anlass').value;
        
        let match = wineDatabase.find(w => w.type === typ && w.mood === anlass) || wineDatabase.find(w => w.type === typ);

        if (match) {
            document.getElementById('weinName').innerHTML = "üçæ Wir empfehlen: " + match.name;
            document.getElementById('weinDesc').innerText = match.desc;
            document.getElementById('science-text').innerText = match.science;
            document.getElementById('results').style.display = 'block';
            renderProtein(match.proteinID);
            renderChart(match.type);
        }
    }

    function renderProtein(pdbId) {
        let element = document.getElementById('viewer_3d');
        if (!viewer) viewer = $3Dmol.createViewer(element, { backgroundColor: 'white' });
        viewer.clear();
        $3Dmol.download("pdb:" + pdbId, viewer, {doAssembly:true, noSecondaryStructure:false}, function() {
            viewer.setStyle({}, {cartoon: {color: 'spectrum'}});
            viewer.zoomTo();
            viewer.render();
        });
    }

    function renderChart(activeType) {
        const ctx = document.getElementById('terroirChart').getContext('2d');
        const colors = { "Rot (Komplex)": "#8B0000", "Wei√ü (Frisch)": "#F1C40F", "Ros√© (Balance)": "#E91E63" };
        
        const datasets = Object.keys(colors).map(label => ({
            label: label,
            data: pcaData.filter(d => d.type === label),
            backgroundColor: colors[label],
            pointRadius: (ctx) => {
                const typeMap = { "rot": "Rot (Komplex)", "weiss": "Wei√ü (Frisch)", "rose": "Ros√© (Balance)" };
                return typeMap[activeType] === label ? 10 : 5;
            }
        }));

        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'scatter',
            data: { datasets: datasets },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } },
                scales: { x: { display: false }, y: { display: false } }
            }
        });
    }
</script>

</body>
</html>
