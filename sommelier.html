<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rosary Bio2.0 | Digital Molecular Sommelier</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>

    <style>
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background: #f9f9f9; color: #333; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        h1 { color: #8B0000; text-align: center; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #666; font-style: italic; margin-bottom: 40px; }
        
        /* Formular Styling */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #444; }
        select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; background: #fff; }
        
        button { 
            width: 100%; padding: 15px; background-color: #8B0000; color: white; 
            border: none; border-radius: 8px; font-size: 18px; cursor: pointer; transition: background 0.3s; margin-top: 10px;
        }
        button:hover { background-color: #600000; }

        /* Ergebnisse */
        #results { margin-top: 30px; padding: 20px; border-left: 5px solid #8B0000; background: #fff5f5; display: none; border-radius: 4px; }
        #results h2 { margin-top: 0; color: #8B0000; }

        /* 3D Viewer */
        #protein-viewer-container {
            margin-top: 40px;
            border: 1px solid #eee;
            border-radius: 12px;
            overflow: hidden;
            display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .viewer-header { background: #2c3e50; color: white; padding: 15px; text-align: center; }
        #viewer_3d { width: 100%; height: 400px; position: relative; background: white; }

        /* Chart Container */
        .chart-container { margin-top: 50px; padding-top: 30px; border-top: 2px dashed #eee; }
        .chart-wrapper { position: relative; height: 400px; width: 100%; }
        
        .badge { display: inline-block; background: #2c3e50; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.8em; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üç∑ Digital Molecular Sommelier</h1>
    <p class="subtitle">Verbinde Geschmack (Sensorik) mit Wissenschaft (Proteine & Chemie)</p>

    <form id="sommelierForm">
        <div class="form-group">
            <label for="typ">Weinart:</label>
            <select id="typ">
                <option value="rot">Rotwein</option>
                <option value="weiss">Wei√üwein</option>
                <option value="rose">Ros√©</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="anlass">Anlass / Stimmung:</label>
            <select id="anlass">
                <option value="kamin">Kaminabend (Tiefgr√ºndig)</option>
                <option value="terrasse">Sommerterrasse (Frisch)</option>
                <option value="dinner">Elegantes Dinner (Balanciert)</option>
            </select>
        </div>
        
        <button type="button" onclick="starteAnalyse()">Analyse starten & Wein empfehlen</button>
    </form>

    <div id="results">
        <h2 id="weinName"></h2>
        <p id="weinDesc"></p>
    </div>

    <div id="protein-viewer-container">
        <div class="viewer-header">
            üî¨ <b>Molecular Insight</b><br>
            <span id="science-text" style="font-size:0.9em; opacity:0.9;"></span>
        </div>
        <div id="viewer_3d"></div>
    </div>

    <div class="chart-container">
        <h3>üó∫Ô∏è Terroir-Map: Der Chemische Fingerabdruck</h3>
        <p style="font-size: 0.9em; color: #666;">
            Diese Grafik zeigt die chemische Analyse unserer Weine (basierend auf S√§ure, Alkohol, Mineralik).
            Jeder Punkt ist ein Wein. √Ñhnliche Weine liegen nah beieinander.
        </p>
        <div class="chart-wrapper">
            <canvas id="terroirChart"></canvas>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // 1. DATENBANK (Das "Gehirn")
    // ==========================================
    
    // A. Die Weine & Proteine
    const wineDatabase = [
        {
            id: "prime_red",
            type: "rot",
            mood: "kamin",
            name: "Rosary 'Deep Roots' Sp√§tburgunder",
            desc: "Ein tiefgr√ºndiger Roter, gewachsen auf vulkanischem Gestein. Noten von dunkler Kirsche, Tabak und Erde.",
            proteinID: "1TQN", // Cholin-Dehydrogenase
            scienceTitle: "Enzym: Cholin-Dehydrogenase",
            scienceDesc: "Hitzeschutz-Protein. Sorgt daf√ºr, dass die Rebe auch bei D√ºrre Aromen bildet."
        },
        {
            id: "solaris_white",
            type: "weiss",
            mood: "terrasse",
            name: "Rosary 'Solaris' Bio-Cuv√©e",
            desc: "Spritzig, pilzwiderstandsf√§hig (PIWI) und voller Sonnenenergie. Zitrus und gr√ºner Apfel.",
            proteinID: "1DXJ", // Chitinase
            scienceTitle: "Enzym: Chitinase",
            scienceDesc: "Nat√ºrliche Abwehrkraft. Dieses Enzym sch√ºtzt die PIWI-Rebe vor Pilzbefall ohne Chemie."
        },
        {
            id: "harmony_rose",
            type: "rose",
            mood: "dinner",
            name: "Rosary 'Harmony' Ros√©",
            desc: "Die perfekte Balance. Erdbeere trifft auf mineralische Frische.",
            proteinID: "3MJD", // Invertase
            scienceTitle: "Enzym: Invertase",
            scienceDesc: "Reguliert das Zucker-S√§ure-Spiel in der Beere f√ºr perfekte Harmonie."
        }
    ];

    // B. Die PCA Daten (Simuliert aus Ihrem Python-Code)
    // Hier f√ºgen wir das JSON ein, das der Python Code generiert h√§tte.
    const pcaData = [
        { x: -2.5, y: 0.5, type: "Premium (Rot)" },
        { x: -2.3, y: 0.8, type: "Premium (Rot)" },
        { x: -2.8, y: 0.2, type: "Premium (Rot)" },
        { x: -2.1, y: 0.6, type: "Premium (Rot)" },
        { x: 2.1, y: -1.2, type: "Leicht (Weiss)" },
        { x: 1.9, y: -0.9, type: "Leicht (Weiss)" },
        { x: 2.5, y: -1.5, type: "Leicht (Weiss)" },
        { x: 2.2, y: -1.1, type: "Leicht (Weiss)" },
        { x: 0.1, y: 1.5, type: "Balance (Ros√©)" },
        { x: -0.2, y: 1.2, type: "Balance (Ros√©)" },
        { x: 0.3, y: 1.8, type: "Balance (Ros√©)" }
    ];

    // ==========================================
    // 2. LOGIK (Sommelier)
    // ==========================================

    function starteAnalyse() {
        const typ = document.getElementById('typ').value;
        const anlass = document.getElementById('anlass').value;
        
        // Suche passenden Wein
        let match = wineDatabase.find(w => w.type === typ && w.mood === anlass);
        
        // Fallback, wenn exakte Kombi nicht existiert
        if (!match) {
            match = wineDatabase.find(w => w.type === typ);
        }

        if (match) {
            // UI Updates
            document.getElementById('weinName').innerText = "üçæ Empfehlung: " + match.name;
            document.getElementById('weinDesc').innerText = match.desc;
            document.getElementById('results').style.display = 'block';
            
            // Science Text Update
            document.getElementById('science-text').innerHTML = `
                <b>${match.scienceTitle}:</b> ${match.scienceDesc}
            `;

            // 3D Viewer starten
            showProtein(match.proteinID);
        }
    }

    // ==========================================
    // 3. 3D VISUALISIERUNG (AlphaFold/PDB)
    // ==========================================
    
    let viewer = null;

    function showProtein(pdbId) {
        const viewerDiv = document.getElementById('protein-viewer-container');
        viewerDiv.style.display = 'block';

        let element = document.getElementById('viewer_3d');
        
        if (!viewer) {
            let config = { backgroundColor: 'white' };
            viewer = $3Dmol.createViewer(element, config);
        }

        viewer.clear();
        
        // Lade Struktur von RCSB PDB
        $3Dmol.download("pdb:" + pdbId, viewer, {doAssembly:true, noSecondaryStructure:false}, function() {
            viewer.setStyle({}, {cartoon: {color: 'spectrum'}, stick: {}});
            viewer.zoomTo();
            viewer.render();
        });
    }

    // ==========================================
    // 4. CHART VISUALISIERUNG (PCA Map)
    // ==========================================

    function initChart() {
        const ctx = document.getElementById('terroirChart').getContext('2d');
        
        // Daten gruppieren f√ºr Farben
        const rotData = pcaData.filter(d => d.type.includes("Rot"));
        const weissData = pcaData.filter(d => d.type.includes("Weiss"));
        const roseData = pcaData.filter(d => d.type.includes("Ros√©"));

        new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'Premium Rot (Komplex)',
                        data: rotData,
                        backgroundColor: '#8B0000', // Dunkelrot
                        pointRadius: 6
                    },
                    {
                        label: 'Leicht Wei√ü (Frisch)',
                        data: weissData,
                        backgroundColor: '#F1C40F', // Gelb
                        pointRadius: 6
                    },
                    {
                        label: 'Ros√© (Balance)',
                        data: roseData,
                        backgroundColor: '#E91E63', // Pink
                        pointRadius: 6
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label;
                            }
                        }
                    }
                },
                scales: {
                    x: { 
                        title: { display: true, text: 'Chemische Komplexit√§t (PC1)' },
                        grid: { color: '#eee' }
                    },
                    y: { 
                        title: { display: true, text: 'Terroir Charakter (PC2)' },
                        grid: { color: '#eee' }
                    }
                }
            }
        });
    }

    // Chart starten beim Laden
    window.onload = function() {
        initChart();
    };

</script>

</body>
</html>
